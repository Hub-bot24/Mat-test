<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#111111">
<title>Mat Test — Offline Calculator (v1.3)</title>
<style>
  :root{ --gap:14px; --pad:16px; --radius:14px; --font: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;}
  html, body { height:100%; background:#f7f7f9; color:#111; font-family: var(--font); margin:0; }
  .wrap { max-width: 720px; margin: 0 auto; padding: min(4vh,30px) min(3vw,20px); }
  h1 { font-size: clamp(20px, 3.4vw, 28px); margin:0 0 12px; }
  .card { background:#fff; border-radius: var(--radius); padding: var(--pad); box-shadow: 0 8px 24px rgba(0,0,0,.06);}
  .grid { display:grid; gap: var(--gap); }
  label { font-size: 14px; color:#333; }
  input[type="number"], input.output { width: 100%; font-size: 18px; padding:12px; border:1px solid #ccc; border-radius: 10px; background:#fbfbfc; }
  input.output[readonly] { pointer-events: none; background:#f0f2f5; }
  .row { display:grid; grid-template-columns: 1fr; gap: var(--gap); }
  .actions { display:flex; gap:10px; margin-top:8px; flex-wrap:wrap; }
  button { font-size: 16px; padding: 12px 16px; border-radius: 10px; border:1px solid #ddd; background:#fff; }
  button.primary { background:#111; color:#fff; border-color:#111; }
  .muted { color:#666; font-size:12px; }
  footer { margin-top:20px; color:#666; font-size:12px; text-align:center; }
  .note { background:#fff7cc; border:1px solid #ffe37a; padding:10px 12px; border-radius:10px; font-size:13px; margin:0 0 12px; }
  .debug { font-size:12px; color:#555; background:#eef5ff; border:1px dashed #b8d3ff; padding:8px 10px; border-radius:8px; }
  @media print { body { background:#fff; } .actions { display:none; } .card { box-shadow:none; border:1px solid #eee; } }
</style>
</head>
<body>
<div class="wrap">
  <h1>Field Spread Rate — Offline Calculator</h1>
  <div class="note">If numbers don’t update, press <strong>Calculate</strong>. Version v1.3 • 2025-09-10</div>
  <div class="card grid">

    <div class="row">
      <div>
        <label for="M1">Mass of Canvas Mat &amp; Aggregate (kg)</label>
        <input id="M1" type="number" inputmode="decimal" step="any" placeholder="">
      </div>
      <div>
        <label for="M2">Mass of Canvas Mat (kg)</label>
        <input id="M2" type="number" inputmode="decimal" step="any" value="0.85">
      </div>
      <div>
        <label for="A">Area of Canvas Mat (m²)</label>
        <input id="A" type="number" inputmode="decimal" step="any" value="0.97">
      </div>
      <div>
        <label for="R1">Spread Rate (kg/m²) = (M1 − M2) / A</label>
        <input id="R1" class="output" type="text" readonly>
      </div>
      <div>
        <label for="DL">Loose Unit Mass of Screenings (t/m³)</label>
        <input id="DL" type="number" inputmode="decimal" step="any" value="1.45">
      </div>
      <div>
        <label for="R2">Spread Rate (m²/m³) = 1000 × DL / R1</label>
        <input id="R2" class="output" type="text" readonly>
      </div>
    </div>

    <div class="actions">
      <button class="primary" id="calc">Calculate</button>
      <button id="clear">Clear</button>
      <span class="muted">Live updates • Works offline • Up to 6 decimals</span>
    </div>
    <div class="debug" id="dbg">Ready…</div>
  </div>

  <footer>© Mat Test Mobile — offline | Created by <strong>J. Hugo</strong> | v1.3 • 2025-09-10</footer>
</div>

<script>
(function(){
  function $(id){ return document.getElementById(id); }
  function fmt(v){ if (!isFinite(v)) return ""; return (Math.round(v*1e6)/1e6).toString(); }
  function toNum(v){ if (v===null||v===undefined||v==="") return null; v=String(v).replace(",", "."); var x=parseFloat(v); return isNaN(x)?null:x; }

  if (!$("#M2").value) $("#M2").value="0.85";
  if (!$("#A").value)  $("#A").value ="0.97";
  if (!$("#DL").value) $("#DL").value="1.45";
  $("#M1").value="";

  function calc(){
    var M1=toNum($("#M1").value), M2=toNum($("#M2").value), A=toNum($("#A").value), DL=toNum($("#DL").value);
    var R1=null; if(M1!==null&&M2!==null&&A!==null&&A!==0){ R1=(M1-M2)/A; }
    var R2=null; if(DL!==null&&R1!==null&&R1!==0){ R2=1000*DL/R1; }
    $("#R1").value=(R1===null?"":fmt(R1));
    $("#R2").value=(R2===null?"":fmt(R2));
    $("#dbg").textContent="M1="+(M1===null?"":M1)+" | M2="+(M2===null?"":M2)+" | A="+(A===null?"":A)+" | DL="+(DL===null?"":DL)+" => R1="+(R1===null?"":fmt(R1))+", R2="+(R2===null?"":fmt(R2));
  }

  var ids=["M1","M2","A","DL"];
  for(var i=0;i<ids.length;i++){ (function(id){ var el=$(id); ["input","change","keyup","blur"].forEach(function(ev){ el.addEventListener(ev, calc, false); }); })(ids[i]); }
  $("#calc").addEventListener("click", calc, false);
  $("#clear").addEventListener("click", function(){ ["M1","M2","A","DL","R1","R2"].forEach(function(id){ $(id).value=""; }); $("#M2").value="0.85"; $("#A").value="0.97"; $("#DL").value="1.45"; $("#M1").focus(); calc(); }, false);
  setInterval(calc, 300);
  calc();

  if('serviceWorker' in navigator){ try{ navigator.serviceWorker.register('./service-worker.js?v=5'); }catch(e){} }
})();
</script>
</body>
</html>
