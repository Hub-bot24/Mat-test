
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mat Test — Field Spread Rate</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <section class="page print-scale">
    <div class="header">
      <img src="colas-logo.svg" alt="Colas" style="height:40px;">
      <div>
        <h1>Field Spread Rate of Cover Aggregate (Canvas Mat)</h1>
        <div class="sub">Works offline • Phone = Desktop • One-page PDF</div>
      </div>
    </div>

    <div class="grid">
      <div>
        <label>Mass of Canvas Mat & Aggregate (kg)</label>
        <input type="number" id="m1" step="0.000001" placeholder="M1">
      </div>
      <div>
        <label>Mass of Canvas Mat (kg)</label>
        <input type="number" id="m2" step="0.000001" placeholder="M2">
      </div>
      <div>
        <label>Area of Canvas Mat (m²)</label>
        <input type="number" id="area" step="0.000001" placeholder="A">
      </div>
      <div>
        <label>Spread Rate (kg/m²) = (M1 − M2) / A</label>
        <input type="text" id="r1" readonly>
      </div>
      <div>
        <label>Loose Unit Mass of Screenings (t/m³)</label>
        <input type="number" id="dl" step="0.000001" placeholder="DL">
      </div>
      <div>
        <label>Spread Rate (m²/m³) = 1000 × DL / R1</label>
        <input type="text" id="r2" readonly>
      </div>
    </div>

    <div class="actions no-print">
      <button class="btn green" id="btnCalc">Calculate</button>
      <button class="btn red" id="btnClear">Clear</button>
      <button class="btn blue" id="btnPdf2">PDF</button>
    </div>

    <div class="nav no-print" style="display:flex;gap:10px;justify-content:center;margin-top:10px">
      <a class="btn blue" href="index.html">Back to Page 1</a>
    </div>
  </section>

  <script>
    function two(n){ return (Math.round(n*100)/100).toFixed(2); }
    function calc(){
      const m1 = parseFloat(document.getElementById('m1').value || '0');
      const m2 = parseFloat(document.getElementById('m2').value || '0');
      const A  = parseFloat(document.getElementById('area').value || '0');
      const dl = parseFloat(document.getElementById('dl').value || '0');
      const r1El = document.getElementById('r1');
      const r2El = document.getElementById('r2');

      if(!A || A<=0){ r1El.value=''; r2El.value=''; return; }
      const r1 = (m1 - m2) / A;
      if(!isFinite(r1) || r1<=0){ r1El.value=''; r2El.value=''; return; }
      r1El.value = two(r1);

      const r2 = 1000 * dl / r1;
      r2El.value = isFinite(r2) ? two(r2) : '';
    }
    function clearAll(){
      ['m1','m2','area','dl','r1','r2'].forEach(id=>{
        const el = document.getElementById(id);
        if(el) el.value='';
      });
    }
    document.getElementById('btnCalc').addEventListener('click', calc);
    document.getElementById('btnClear').addEventListener('click', clearAll);
    // Auto-calc on input (so it "feels live") but still keeps the Calculate button
    ['m1','m2','area','dl'].forEach(id=>{
      const el = document.getElementById(id);
      el.addEventListener('input', calc);
    });

    // Single-page print scaling
    function preparePrintFit(){
      const page = document.querySelector('.page');
      if(!page) return;
      const prevTransform = page.style.transform;
      if (getComputedStyle(page).transform !== 'none' && window.innerWidth < 980){
        page.style.transform = 'none';
      }
      const contentH = page.scrollHeight;
      const targetPx = 1122;
      let scale = 1;
      if (contentH > targetPx){
        scale = (targetPx / contentH) * 0.98;
        if (scale < 0.7) scale = 0.7;
      }
      document.documentElement.style.setProperty('--print-scale', String(scale));
      page.style.transform = prevTransform || '';
    }
    document.getElementById('btnPdf2').addEventListener('click', ()=>{
      preparePrintFit(); setTimeout(()=>window.print(), 20);
    });
  </script>
</body>
</html>
